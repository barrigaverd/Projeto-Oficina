{% extends 'base.html' %}
{% block content %}
<div class="text-md-start">
  <button class="btn btn-secondary btn-sm px-4" onclick="retornar()">Voltar</button>
</div>
<div class="d-flex justify-content-center">
  <div class="card shadow-sm w-100 mx-auto my-4" style="max-width: 600px;">
    <div class="card-header text-center bg-primary text-white fw-bold">
      Etapa 2 — Formação Acadêmica e Cursos
    </div>
    <div class="card-body">
      
      <form method="POST" action="">
        {{ form.hidden_tag() }}

        <h5 class="mb-2">Formação Acadêmica</h5>
        <div id="formacao-container">
          {% for subfield in form.formacoes %}
          <div class="form-item-wrapper d-flex mb-2">
            {{ subfield(class='form-control me-2', placeholder='Formação...') }}
            <button type="button" class="btn btn-danger btn-sm remove-item">&times;</button>
          </div>
          {% endfor %}
        </div>
        <button type="button" id="add-formacao" class="btn btn-outline-primary btn-sm mt-2">
          <i class="bi bi-plus-circle"></i> Adicionar Formação
        </button>

        <hr class="my-4">

        <h5 class="mb-2">Cursos Complementares</h5>
        <div id="curso-container">
          {% for subfield in form.cursos %}
          <div class="form-item-wrapper d-flex mb-2">
            {{ subfield(class='form-control me-2', placeholder='Curso...') }}
            <button type="button" class="btn btn-danger btn-sm remove-item">&times;</button>
          </div>
          {% endfor %}
        </div>
        <button type="button" id="add-curso" class="btn btn-outline-primary btn-sm mt-2">
          <i class="bi bi-plus-circle"></i> Adicionar Curso
        </button>
        
        <hr class="my-4">

        <div class="d-flex justify-content-end">
          {{ form.submit(class='btn btn-primary') }}
        </div>
        
      </form>
      </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Lógica para Formações
      const addFormacao = document.getElementById("add-formacao");
      const formacaoContainer = document.getElementById("formacao-container");
      let formacaoContador = formacaoContainer.querySelectorAll('.form-item-wrapper').length;

      addFormacao.addEventListener("click", () => {
        const wrapperDiv = document.createElement('div');
        wrapperDiv.className = 'form-item-wrapper d-flex mb-2';
        wrapperDiv.innerHTML = `
            <input name="formacoes-${formacaoContador}" class="form-control me-2" placeholder="Nova formação...">
            <button type="button" class="btn btn-danger btn-sm remove-item">&times;</button>
        `;
        formacaoContainer.appendChild(wrapperDiv);
        formacaoContador++;
      });

      // Lógica para Cursos
      const addCurso = document.getElementById("add-curso");
      const cursoContainer = document.getElementById("curso-container");
      let cursoContador = cursoContainer.querySelectorAll('.form-item-wrapper').length;

      addCurso.addEventListener("click", () => {
        const wrapperDiv = document.createElement('div');
        wrapperDiv.className = 'form-item-wrapper d-flex mb-2';
        wrapperDiv.innerHTML = `
            <input name="cursos-${cursoContador}" class="form-control me-2" placeholder="Novo curso...">
            <button type="button" class="btn btn-danger btn-sm remove-item">&times;</button>
        `;
        cursoContainer.appendChild(wrapperDiv);
        cursoContador++;
      });

      // Delegação de eventos para os botões de remover (funciona para ambos os containers)
      const mainCardBody = document.querySelector('.card-body');
      mainCardBody.addEventListener('click', function(event) {
          if (event.target.classList.contains('remove-item')) {
              const wrapperParaRemover = event.target.closest('.form-item-wrapper');
              if (wrapperParaRemover) {
                  wrapperParaRemover.remove();
              }
          }
      });
    });
  </script>
{% endblock %}