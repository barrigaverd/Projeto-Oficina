{% extends 'base_publica.html' %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Sua Área de Downloads</h2>

  <form method="GET" action="{{ url_for('dashboard_resets') }}" class="row g-2 mb-4">
    <div class="col-md-9">
      <input type="text" name="busca" class="form-control shadow-sm" placeholder="Buscar por categoria..." value="{{ termos_busca }}">
    </div>
    <div class="col-md-3 d-grid">
      <button type="submit" class="btn btn-primary shadow-sm"><i class="bi bi-search"></i> Pesquisar</button>
    </div>
  </form>

  {% if impressoras %}
  <div class="accordion" id="accordionResets">

    {% for impressora in impressoras %}
    <div class="accordion-item">
      <h2 class="accordion-header" id="heading-{{ impressora.id }}">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ impressora.id }}" aria-expanded="false" aria-controls="collapse-{{ impressora.id }}">
          <strong><i class="bi bi-folder me-2"></i>{{ impressora.modelo }}</strong>
        </button>
      </h2>
      <div id="collapse-{{ impressora.id }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ impressora.id }}" data-bs-parent="#accordionResets">
        <div class="accordion-body">

          {% if impressora.descricao %}
            <p class="text-muted">{{ impressora.descricao }}</p>
            <hr>
          {% endif %}

          <ul class="list-group">
            {% for recurso in impressora.recursos %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{ recurso.tipo }}:</strong> {{ recurso.descricao }}
                  <small class="d-block text-muted">{{ recurso.sistema_operacional or '' }}</small>
                </div>
                <a href="{{ recurso.link_download }}" target="_blank" class="btn btn-success btn-sm">
                  <i class="bi bi-download me-1"></i> Baixar
                </a>
              </li>
            {% else %}
              <li class="list-group-item">Nenhum link cadastrado para esta categoria.</li>
            {% endfor %}
          </ul>

        </div>
      </div>
    </div>
    {% endfor %}

  </div>
  {% else %}
    <div class="alert alert-info text-center">
      Nenhuma categoria encontrada para sua busca.
    </div>
  {% endif %}
  {% if paginacao.pages > 1 %}
<nav aria-label="Navegação das páginas">
  <ul class="pagination justify-content-center mt-4">

    <li class="page-item {% if not paginacao.has_prev %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('dashboard_resets', page=paginacao.prev_num, termo_busca=termo_busca) }}">Anterior</a>
    </li>

    {% for num_pagina in paginacao.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
      {% if num_pagina %}
        {% if num_pagina == paginacao.page %}
          <li class="page-item active" aria-current="page">
            <a class="page-link" href="#">{{ num_pagina }}</a>
          </li>
        {% else %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('dashboard_resets', page=num_pagina, termo_busca=termo_busca) }}">{{ num_pagina }}</a>
          </li>
        {% endif %}
      {% else %}
        <li class="page-item disabled"><span class="page-link">...</span></li>
      {% endif %}
    {% endfor %}

    <li class="page-item {% if not paginacao.has_next %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('dashboard_resets', page=paginacao.next_num, termo_busca=termo_busca) }}">Próximo</a>
    </li>

  </ul>
</nav>
{% endif %}

</div>
{% endblock %}