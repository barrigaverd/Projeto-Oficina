{% extends 'base.html' %}
{% block content %}
<div class="text-md-start">
    <button class="btn btn-secondary btn-sm px-4" onclick="retornar()">Voltar</button>
</div>
<div class="container mt-4">
    <div class="card shadow-sm rounded-3 mx-auto" style="max-width: 700px;">
        <div class="card-header bg-primary text-white text-center">
            <h4 class="mb-0">Experiências Profissionais</h4>
        </div>
        <div class="card-body">
            <form method="POST" action="">
                {{ form.hidden_tag() }}
                <div id="experiencia-container">
                    {% for experiencia_form in form.experiencias %}
                    <div class="card card-body mb-3 border-0 shadow-sm">
                        <div class="mb-2">
                            {{ experiencia_form.empresa.label(class='form-label fw-bold') }}
                            {{ experiencia_form.empresa(class='form-control') }}
                        </div>
                        <div class="mb-2">
                            {{ experiencia_form.cargo.label(class='form-label fw-bold') }}
                            {{ experiencia_form.cargo(class='form-control') }}
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                {{ experiencia_form.data_admissao.label(class='form-label fw-bold') }}
                                {{ experiencia_form.data_admissao(class='form-control') }}
                            </div>
                            <div class="col-md-6 mb-2">
                                {{ experiencia_form.data_demissao.label(class='form-label fw-bold') }}
                                {{ experiencia_form.data_demissao(class='form-control') }}
                            </div>
                        </div>
                        <div class="form-check mb-2">
                            {{ experiencia_form.desabilitar_datas(class='form-check-input') }}
                            {{ experiencia_form.desabilitar_datas.label(class='form-check-label') }}
                        </div>
                        
                        <div class="mb-2">
                            {{ experiencia_form.periodo.label }}
                            {{ experiencia_form.periodo(class='form-control') }}
                            {% for error in experiencia_form.periodo.errors %}
                                <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="d-flex justify-content-between mt-3">
                    <button type="button" id="add-experiencia" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-plus-circle"></i> Adicionar Experiência
                    </button>
                    
                    {{ form.submit(class='btn btn-success btn-sm') }}

                </div>
                
                
               
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    const ad_experiencia = document.getElementById("add-experiencia");
    let contador = document.querySelectorAll('#experiencia-container .card').length;

    ad_experiencia.addEventListener("click", function () {
        let novo_bloco = document.createElement("div");
        novo_bloco.className = "card card-body mb-3 border-0 shadow-sm";
        novo_bloco.innerHTML = `
            <label class="form-label fw-bold">Empresa</label>
            <input type="text" name="experiencias-${contador}-empresa" class="form-control mb-2">

            <label class="form-label fw-bold">Cargo</label>
            <input type="text" name="experiencias-${contador}-cargo" class="form-control mb-2">

            <div class="row">
                <div class="col-md-6 mb-2">
                    <label class="form-label fw-bold">Data de Admissão</label>
                    <input type="date" name="experiencias-${contador}-data_admissao" class="form-control">
                </div>
                <div class="col-md-6 mb-2">
                    <label class="form-label fw-bold">Data de Demissão</label>
                    <input type="date" name="experiencias-${contador}-data_demissao" class="form-control">
                </div>
            </div>
            <div class="form-check mb-2">
                <input type="checkbox" name="experiencias-${contador}-desabilitar_datas" class="form-check-input">
                <label class="form-check-label">Desabilitar datas</label>
            </div>
            <div class="mb-2">
                <label class="form-label fw-bold">Período</label>
                <input type="text" name="experiencias-${contador}-periodo" class="form-control">
            </div>
            <button type="button" class="btn btn-danger btn-sm remove-item" style="position: absolute; top: 10px; right: 10px;">&times;</button>
        `;
        document.getElementById("experiencia-container").appendChild(novo_bloco);
        contador++;
        
    });

    const container = document.getElementById('experiencia-container');

    container.addEventListener('change', function(event) {
        // Verifica se o que mudou foi um checkbox de desabilitar
        if (event.target.name && event.target.name.includes('desabilitar_datas')) {
            const checkbox = event.target;
            const cardPai = checkbox.closest('.card'); // Encontra o card pai

            // Encontra os inputs e labels de data dentro APENAS deste card
            const labelAdmissao = cardPai.querySelector('label[for*="data_admissao"]');
            const inputAdmissao = cardPai.querySelector('input[name*="data_admissao"]');
            const labelDemissao = cardPai.querySelector('label[for*="data_demissao"]');
            const inputDemissao = cardPai.querySelector('input[name*="data_demissao"]');
            const periodo = cardPai.querySelector('input[name*="periodo"]');


            // Decide se esconde ou mostra os campos
            const deveEsconder = checkbox.checked;
            let deveMostrar = !deveEsconder;


            // Aplica a lógica de esconder/mostrar (ex: usando a classe d-none do Bootstrap)
            
            inputAdmissao.classList.toggle('d-none', deveEsconder);
            
            inputDemissao.classList.toggle('d-none', deveEsconder);
            
            periodo.classList.toggle('d-none', deveMostrar);

        }
    });

    container.addEventListener('click', function(event) {
        if (event.target.classList.contains('remove-item')) {
            event.target.closest('.card').remove();
        }
    });
</script>
{% endblock %}